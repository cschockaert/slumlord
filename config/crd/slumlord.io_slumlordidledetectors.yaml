---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.20.0
  name: slumlordidledetectors.slumlord.io
spec:
  group: slumlord.io
  names:
    kind: SlumlordIdleDetector
    listKind: SlumlordIdleDetectorList
    plural: slumlordidledetectors
    singular: slumlordidledetector
  scope: Namespaced
  versions:
  - additionalPrinterColumns:
    - jsonPath: .spec.action
      name: Action
      type: string
    - jsonPath: .spec.idleDuration
      name: Idle Duration
      type: string
    - jsonPath: .status.lastCheckTime
      name: Last Check
      type: date
    - jsonPath: .metadata.creationTimestamp
      name: Age
      type: date
    name: v1alpha1
    schema:
      openAPIV3Schema:
        description: SlumlordIdleDetector is the Schema for the SlumlordIdleDetectors
          API
        properties:
          apiVersion:
            description: |-
              APIVersion defines the versioned schema of this representation of an object.
              Servers should convert recognized schemas to the latest internal value, and
              may reject unrecognized values.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources
            type: string
          kind:
            description: |-
              Kind is a string value representing the REST resource this object represents.
              Servers may infer this from the endpoint the client submits requests to.
              Cannot be updated.
              In CamelCase.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds
            type: string
          metadata:
            type: object
          spec:
            description: SlumlordIdleDetectorSpec defines the desired state of SlumlordIdleDetector
            properties:
              action:
                description: |-
                  Action defines what to do when a workload is detected as idle
                  Valid values: "alert", "scale", "resize"
                enum:
                - alert
                - scale
                - resize
                type: string
              idleDuration:
                description: IdleDuration is how long a workload must be idle before
                  action (e.g., "30m", "1h")
                pattern: ^([0-9]+h)?([0-9]+m)?([0-9]+s)?$
                type: string
              reconcileInterval:
                description: |-
                  ReconcileInterval overrides the default reconciliation interval.
                  Controls how often the controller checks for idle workloads.
                  Defaults to 5m if not specified.
                type: string
              resize:
                description: Resize configures the resize action parameters. Required
                  when action=resize.
                properties:
                  bufferPercent:
                    default: 25
                    description: |-
                      BufferPercent is the percentage of headroom to add above actual usage
                      when computing target requests. E.g., 25 means target = usage * 1.25
                    format: int32
                    maximum: 200
                    minimum: 0
                    type: integer
                  minRequests:
                    description: |-
                      MinRequests defines the minimum resource requests floor.
                      The controller will never resize below these values.
                    properties:
                      cpu:
                        anyOf:
                        - type: integer
                        - type: string
                        default: 50m
                        description: CPU is the minimum CPU request (e.g., "50m",
                          "100m")
                        pattern: ^(\+|-)?(([0-9]+(\.[0-9]*)?)|(\.[0-9]+))(([KMGTPE]i)|[numkMGTPE]|([eE](\+|-)?(([0-9]+(\.[0-9]*)?)|(\.[0-9]+))))?$
                        x-kubernetes-int-or-string: true
                      memory:
                        anyOf:
                        - type: integer
                        - type: string
                        default: 64Mi
                        description: Memory is the minimum memory request (e.g., "64Mi",
                          "128Mi")
                        pattern: ^(\+|-)?(([0-9]+(\.[0-9]*)?)|(\.[0-9]+))(([KMGTPE]i)|[numkMGTPE]|([eE](\+|-)?(([0-9]+(\.[0-9]*)?)|(\.[0-9]+))))?$
                        x-kubernetes-int-or-string: true
                    type: object
                type: object
              selector:
                description: Selector specifies which workloads to monitor
                properties:
                  matchLabels:
                    additionalProperties:
                      type: string
                    description: MatchLabels selects workloads by labels
                    type: object
                  matchNames:
                    description: MatchNames selects workloads by name (supports wildcards)
                    items:
                      type: string
                    type: array
                  types:
                    description: |-
                      Types specifies which workload types to target
                      Valid values: Deployment, StatefulSet, CronJob, Cluster, HelmRelease, Kustomization, ThanosRuler, Alertmanager, Prometheus, MariaDB, MaxScale, Elasticsearch, Kibana
                    items:
                      type: string
                    type: array
                type: object
              thresholds:
                description: Thresholds defines the resource usage thresholds for
                  idle detection
                properties:
                  cpuPercent:
                    description: |-
                      CPUPercent is the CPU usage percentage threshold (0-100)
                      Workloads using less than this are considered idle
                    format: int32
                    maximum: 100
                    minimum: 0
                    type: integer
                  memoryPercent:
                    description: |-
                      MemoryPercent is the memory usage percentage threshold (0-100)
                      Workloads using less than this are considered idle
                    format: int32
                    maximum: 100
                    minimum: 0
                    type: integer
                type: object
            required:
            - action
            - idleDuration
            - selector
            - thresholds
            type: object
          status:
            description: SlumlordIdleDetectorStatus defines the observed state of
              SlumlordIdleDetector
            properties:
              idleWorkloads:
                description: IdleWorkloads lists workloads detected as idle
                items:
                  description: IdleWorkload represents a workload detected as idle
                  properties:
                    currentCPUPercent:
                      description: CurrentCPUPercent is the current CPU usage percentage
                      format: int32
                      type: integer
                    currentMemoryPercent:
                      description: CurrentMemoryPercent is the current memory usage
                        percentage
                      format: int32
                      type: integer
                    idleSince:
                      description: IdleSince is when the workload was first detected
                        as idle
                      format: date-time
                      type: string
                    kind:
                      description: Kind is the workload kind (Deployment, StatefulSet,
                        CronJob)
                      type: string
                    name:
                      description: Name is the workload name
                      type: string
                  required:
                  - idleSince
                  - kind
                  - name
                  type: object
                type: array
              lastCheckTime:
                description: LastCheckTime is the last time idle detection was performed
                format: date-time
                type: string
              resizedWorkloads:
                description: ResizedWorkloads tracks workloads whose pod requests
                  were resized in-place
                items:
                  description: ResizedWorkload tracks a workload whose pod requests
                    were resized in-place
                  properties:
                    currentRequests:
                      additionalProperties:
                        anyOf:
                        - type: integer
                        - type: string
                        pattern: ^(\+|-)?(([0-9]+(\.[0-9]*)?)|(\.[0-9]+))(([KMGTPE]i)|[numkMGTPE]|([eE](\+|-)?(([0-9]+(\.[0-9]*)?)|(\.[0-9]+))))?$
                        x-kubernetes-int-or-string: true
                      description: CurrentRequests stores the current (resized) resource
                        requests
                      type: object
                    kind:
                      description: Kind is the workload kind (Deployment, StatefulSet)
                      type: string
                    name:
                      description: Name is the workload name
                      type: string
                    originalRequests:
                      additionalProperties:
                        anyOf:
                        - type: integer
                        - type: string
                        pattern: ^(\+|-)?(([0-9]+(\.[0-9]*)?)|(\.[0-9]+))(([KMGTPE]i)|[numkMGTPE]|([eE](\+|-)?(([0-9]+(\.[0-9]*)?)|(\.[0-9]+))))?$
                        x-kubernetes-int-or-string: true
                      description: OriginalRequests stores the original resource requests
                        before resize
                      type: object
                    podCount:
                      description: PodCount is the number of pods that were resized
                      format: int32
                      type: integer
                    resizedAt:
                      description: ResizedAt is when the workload pods were last resized
                      format: date-time
                      type: string
                  required:
                  - currentRequests
                  - kind
                  - name
                  - originalRequests
                  - podCount
                  - resizedAt
                  type: object
                type: array
              scaledWorkloads:
                description: ScaledWorkloads tracks workloads that have been scaled
                  down due to idleness
                items:
                  description: ScaledWorkload tracks a workload that was scaled down
                    due to idleness
                  properties:
                    kind:
                      description: Kind is the workload kind (Deployment, StatefulSet,
                        CronJob)
                      type: string
                    name:
                      description: Name is the workload name
                      type: string
                    originalReplicas:
                      description: OriginalReplicas stores the replica count before
                        scaling (for Deployment/StatefulSet)
                      format: int32
                      type: integer
                    originalSuspend:
                      description: OriginalSuspend stores the suspend state before
                        scaling (for CronJob)
                      type: boolean
                    scaledAt:
                      description: ScaledAt is when the workload was scaled down
                      format: date-time
                      type: string
                  required:
                  - kind
                  - name
                  - scaledAt
                  type: object
                type: array
            type: object
        type: object
    served: true
    storage: true
    subresources:
      status: {}
